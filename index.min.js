const DEFAULT_RESPONSE='Erreur lors de l\'appel de l\'API',LIST_METHOD=['GET','POST'],xhrPool=[],cookie={set:function(e,n,t){let o=new Date;o.setTime(o.getTime()+24*t*60*60*1e3);let r='expires='+o.toUTCString();document.cookie=e+'='+n+';'+r+';path=/',console.log('cookie set');},get:function(e=null){let n=!1,t=document.cookie.split(';');return null!==e&&(t.forEach((t=>{(t={name:t.trim().split('=')[0],value:t.trim().split('=')[1]}).name===e&&(n=t.value);})),n);},delete:function(e){!1!==this.get(e)&&(document.cookie=e+'=;path=/;expires=Thu, 01 Jan 1970 00:00:01 GMT',console.log('cookie delete'));}},search={table:function(e,n,t='',o='LIKE'){if('string'==typeof e){const r=document.getElementById(e).querySelector('tbody').rows;for(const e of r)switch(o){case'LIKE':e.querySelectorAll('td')[n].innerHTML.includes(t)?e.classList.contains('mustBeMask')||e.classList.remove('d-none'):e.classList.add('d-none');break;case'EQUAL':e.querySelectorAll('td')[n].innerHTML===t?e.classList.contains('mustBeMask')||e.classList.remove('d-none'):e.classList.add('d-none');}}},array:function(e,n,t='',o='LIKE'){let r=[];return'object'==typeof e&&e.length>0&&e.forEach((e=>{if(e[n])switch(o){case'LIKE':e[n].includes(t)&&r.push(e);break;case'EQUAL':e[n]===t&&r.push(e);}else r=[];})),r;}},sort={table:function(e,n){let t,o,r,l,s,a,i,c=0;for(n=document.getElementById(n),o=!0,s='asc';o;)if(o=!1,t=n.querySelector('tbody').rows,t.length){for(r=0;r<t.length-1;r++)if(l=!1,a=t[r].querySelectorAll('td')[e].innerHTML,i=t[r+1].querySelectorAll('td')[e].innerHTML,a=isNaN(a)?a.includes('%')||a.includes('€')?parseFloat(a.split(/( )|(&nbsp;)/)[0]):a:parseFloat(a),i=isNaN(i)?i.includes('%')||i.includes('€')?parseFloat(i.split(/( )|(&nbsp;)/)[0]):i:parseFloat(i),'asc'===s){if(a>i){l=!0;break;}}else if(a<i){l=!0;break;}l?(t[r].parentNode.insertBefore(t[r+1],t[r]),o=!0,c++):0===c&&'asc'===s&&(s='desc',o=!0);}}};function callAPI(e,n,t=null,o=null,r=null,l=null,s=null,a=null,i=!0){if(!LIST_METHOD.includes(e))throw new Error('Méthode inconnue. Méthode autorisé : '+LIST_METHOD.toString());{const u=new XMLHttpRequest;xhrPool.push(u),u.onreadystatechange=function(){if(4===this.readyState){if(200===this.status)if(''!==this.responseText)if(-1!==this.responseText.indexOf('{')){const e=JSON.parse(this.responseText);e.error?'no'===e.error?r?r(e):displayAlert('main','success','Appel Réussi'):l?l(e):displayAlert('main','warning',e.error):r?r(e):displayAlert('main','warning','Appel Réussi mais mauvais format');}else s?s({error:'Réponse au mauvais format'}):displayAlert('main','danger','Réponse au mauvais format');else s?s({error:'Aucune réponse de la part du serveur malgré un code 200'}):displayAlert('main','danger','Aucune réponse de la part du serveur malgré un code 200');else s?s():displayAlert('main','danger',DEFAULT_RESPONSE);a&&a();}},u.open(e,n+(null!=t&&'GET'===e?'?'+(t instanceof FormData?new URLSearchParams(t).toString():c(t)):''),i),null!=o&&u.setRequestHeader('Authorization','Bearer '+o),u.setRequestHeader('Content-Type','application/x-www-form-urlencoded'),u.send(null!=t&&'POST'===e?t instanceof FormData?new URLSearchParams(t).toString():c(t):'');}function c(e){const n=[];for(const t in e)n.push(encodeURIComponent(t)+'='+encodeURIComponent(e[t]));return n.join('&');}}function displayAlert(e,n,t,o=!0){const r={info:{className:'alert-info',icon:'bi-info-circle'},success:{className:'alert-success',icon:'bi-patch-check'},warning:{className:'alert-warning',icon:'bi-exclamation-triangle'},danger:{className:'alert-danger',icon:'bi-x-octagon'}};if(null==document.querySelector(e))throw new Error('Element absence de la page');{document.querySelectorAll(e+' div.alert').forEach((e=>{o&&e.remove();}));const l=document.createElement('div');l.classList.add('alert','alert-dismissible','fade','show',r[n].className),l.innerHTML='<i class="bi '+r[n].icon+'"></i> '+t+'<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>',document.querySelector(e).prepend(l);}}function loadBtn(e,n,t,o,r=null){if(null===e)throw new Error('Erreur Selector');o=['grow','border'].includes(o)?o:'border',r=null!=r?['sm','lg'].includes(r)?r:'sm':null,e.innerHTML=e.disabled?null==n?'OK':n:'<span class="spinner-'+o+(null!=r?' spinner-'+o+'-'+r:'')+'" role="status" aria-hidden="true"></span>'+(!0!==t?' '+(null==n?'Chargement...':n):''),e.disabled=!e.disabled;}function abortAllRequest(){xhrPool.forEach((e=>{e.abort();})),xhrPool.length=0;}function docId(e){return document.getElementById(e);}function docQ(e){return document.querySelector(e);}function docQAll(e){return document.querySelectorAll(e);}function docCrea(e){return document.createElement(e);}module.exports={DEFAULT_RESPONSE:DEFAULT_RESPONSE,LIST_METHOD:LIST_METHOD,xhrPool:xhrPool,callAPI:callAPI,displayAlert:displayAlert,loadBtn:loadBtn,abortAllRequest:abortAllRequest,docId:docId,docQ:docQ,docQAll:docQAll,docCrea:docCrea,cookie:cookie,search:search,sort:sort};