const DEFAULT_RESPONSE="Erreur lors de l'appel de l'API",LIST_METHOD=["GET","POST"];var xhrPool=[];window.onbeforeunload=function(){abortAllRequest()},window.abortAllRequest=function(){xhrPool.forEach(e=>{e.abort()}),xhrPool.length=0},window.modulesJs={callAPI:function(e,n,t=null,l=null,s=null,o=null,r=null,a=null,i=!0){function c(e){var n=[];for(var t in e)n.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return n.join("&")}if(!LIST_METHOD.includes(e))throw"Méthode inconnue. Méthode autorisé : "+LIST_METHOD.toString();{let u=new XMLHttpRequest;xhrPool.push(u),u.onreadystatechange=function(){if(4==this.readyState){if(200==this.status){var e=JSON.parse(this.responseText);"no"==e.error?s?s(e):modulesJs.displayAlert("main","success","Appel Réussi"):o?o(e):modulesJs.displayAlert("main","warning",e.error)}else r?r():modulesJs.displayAlert("main","danger","Erreur lors de l'appel de l'API");a&&a()}},u.open(e,n+(null!=t&&"GET"==e?"?"+(t instanceof FormData?new URLSearchParams(t).toString():c(t)):""),i),null!=l&&u.setRequestHeader("Authorization","Bearer "+l),u.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),u.send(null!=t&&"POST"==e?t instanceof FormData?new URLSearchParams(t).toString():c(t):"")}},displayAlert:function(e,n,t){const l={info:{className:"alert-info",icon:"bi-info-circle"},success:{className:"alert-success",icon:"bi-patch-check"},warning:{className:"alert-warning",icon:"bi-exclamation-triangle"},danger:{className:"alert-danger",icon:"bi-x-octagon"}};if(null==document.querySelector(e))throw"Element absence de la page";{document.querySelectorAll(e+" div.alert").forEach(e=>{e.remove()});let s=document.createElement("div");s.classList.add("alert","alert-dismissible","fade","show",l[n].className),s.innerHTML='<i class="bi '+l[n].icon+'"></i> '+t+'<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>',document.querySelector(e).prepend(s)}},cookie:{set:function(e,n,t){let l=new Date;l.setTime(l.getTime()+24*t*60*60*1e3);let s="expires="+l.toUTCString();document.cookie=e+"="+n+";"+s+";path=/",console.log("cookie set")},get:function(e){let n=e+"=",t=document.cookie.split(";");for(let e=0;e<t.length;e++){let l=t[e];for(;" "==l.charAt(0);)l=l.substring(1);if(0==l.indexOf(n))return l.substring(n.length,l.length)}return""},delete:function(e){this.get(e)&&(document.cookie=e+"=;path=/;expires=Thu, 01 Jan 1970 00:00:01 GMT")}},search:{table:function(e,n,t="",l="LIKE"){if("string"==typeof e){let s=document.getElementById(e),o=s.querySelector("tbody").rows;for(let e of o)switch(l){case"LIKE":e.querySelectorAll("td")[n].innerHTML.includes(t)?e.classList.contains("mustBeMask")||e.classList.remove("d-none"):e.classList.add("d-none");break;case"EQUAL":e.querySelectorAll("td")[n].innerHTML==t?e.classList.contains("mustBeMask")||e.classList.remove("d-none"):e.classList.add("d-none")}}},array:function(e,n,t="",l="LIKE"){let s=[];return"object"==typeof e&&e.length>0&&e.forEach(e=>{if(e[n])switch(l){case"LIKE":e[n].includes(t)&&s.push(e);break;case"EQUAL":e[n]==t&&s.push(e)}else s=[]}),s}},sort:{table:function(e,n){let t,l,s,o,r,a,i,c=0;for(n=document.getElementById(n),l=!0,r="asc";l;)if(l=!1,t=n.querySelector("tbody").rows,t.length){for(s=0;s<t.length-1;s++)if(o=!1,a=t[s].querySelectorAll("td")[e].innerHTML,i=t[s+1].querySelectorAll("td")[e].innerHTML,a=isNaN(a)?a.includes("%")||a.includes("€")?parseFloat(a.split(/( )|(&nbsp;)/)[0]):a:parseFloat(a),i=isNaN(i)?i.includes("%")||i.includes("€")?parseFloat(i.split(/( )|(&nbsp;)/)[0]):i:parseFloat(i),"asc"==r){if(a>i){o=!0;break}}else if(a<i){o=!0;break}o?(t[s].parentNode.insertBefore(t[s+1],t[s]),l=!0,c++):0==c&&"asc"==r&&(r="desc",l=!0)}}},loadBtn:function(e,n,t,l,s=null){if(null===e)throw"Erreur Selector";l=["grow","border"].includes(l)?l:"border",s=null!=s?["sm","lg"].includes(s)?s:"sm":null,e.innerHTML=e.disabled?null==n?"OK":n:'<span class="spinner-'+l+(null!=s?" spinner-"+l+"-"+s:"")+'" role="status" aria-hidden="true"></span>'+(!0!==t?" "+(null==n?"Chargement...":n):""),e.disabled=!e.disabled}};